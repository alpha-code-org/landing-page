export const metadata = {
  title: "Next.js Infinite Loader",
  publishDate: "2024-09-27T00:00:00Z",
};

# Next.js Infinite Loader with Server Components

React Server Components have changed the way we think about rendering process in React.
Instead of focusing on one environment at a time, components can render on the server and the client simultaneously.

This can be problematic when it comes to infinite loading, because server components don't have access to the state.
For example, if we have a cursor pagination mechanism for data fetching, we need to keep track of the previously loaded pages on
the client. Easiest way would be to store fetched data in the state and every time user reaches the end of the list,
trigger new request with updated cursor and update state with fresh awaited data.

I would definetely recommend using library like React-Query for this task, because it has built-in support for infinite loaders.
You can still prefetch data in server components and seed query cache with initial data, which gives instant feedback to the user.

## Let's get started

For this example, I will use GitHub API to fetch list of users, because it uses cursor pagination. You need to create <Highlight>GITHUB_TOKEN</Highlight> environment variable if you want to follow along. This is our <Highlight>getUsers</Highlight> function:

```ts
const getUsers = async (page: number): Promise<PaginatedResponse<GithubUser[]>> => {
  const PER_PAGE = 12;

  const url = new URL("https://api.github.com/users");

  const params = new URLSearchParams({
    since: "0",
    per_page: `${page * PER_PAGE}`,
  });
  url.search = params.toString();

  const response = await fetch(url, {
    headers: {
      "X-GitHub-Api-Version": "2022-11-28",
      Authorization: `Bearer ${process.env.NEXT_PUBLIC_GITHUB_TOKEN}`,
    },
  });

  if (!response.ok) throw new Error("Failed to fetch users");

  const users = (await response.json()) as GithubUser[];

  const hasNextPage = users.length === page * PER_PAGE;

  return { data: users, nextPage: hasNextPage ? page + 1 : null };
};
```
